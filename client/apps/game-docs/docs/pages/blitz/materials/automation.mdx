# ü§ñ Production Automation

Resource automation allows players to set up continuous production processes within their entities. This system helps
manage resource generation and distribution efficiently without constant manual intervention.

## Overview

Instead of micromanaging multiple production orders, the automation now runs off a single set of sliders per entity,
recomputing the entire plan from those percentages every loop.

**Key Features:**

- **Every minute**: the client starts up production plans for any owned entity with a valid setup.
- **Per-resource percentages**: Each tracked resource has sliders for complex and simple recipes.
- **Presets**: ‚ÄúLabor‚Äù, ‚ÄúResource‚Äù, ‚ÄúCustom‚Äù, and ‚ÄúIdle‚Äù presets instantly distribute percentages across every resource
  with active buildings, respecting entity type and recipe availability.
- **Safety rails**: Inputs are capped at 90% of the live balance.
- **Local persistence**: Configurations are saved per game in your browser so refreshes keep the latest sliders and
  last-run summaries.

## How It Works

Production automation runs a global loop that goes through every owned realm and camp.

1. **Realm discovery**: On execution, the client fetches every owned entity and ensures it has an automation profile.
2. **Resource scan**: Any resource with buildings or an active recipe is auto-added to bootstrap production, even if you
   never touch the sliders.
3. **Budgeting**: Each resource receives 90% of its current balance as a budget. Sliders dictate how much of that budget
   the loop can spend on complex vs. simple recipes.
4. **Plan generation**: Recipes reserve inputs according to your percentages and their per-cycle requirements. Recipes
   without enough inputs are skipped and reported in the summary.
5. **Execution**: If at least one recipe has non-zero cycles, the automation is submitted for that entity.
6. **Feedback loop**: The store records cycles, inputs, outputs, and skipped resources so the UI can show fresh "last
   run" stats.

### Entity Coverage

- **Realms and Camps** are supported; other entity types are ignored for production automation.
- Losing ownership of a realm automatically prunes the associated automation profile.

## Production Types

There are still two production paths, now governed by slider percentages:

1. **Complex (Resource ‚Üí Resource)**:
   - Burns existing resources to craft another according to the `Resource ‚Üí Resource` slider.
   - Example: Spend Wood + Coal to produce Copper.
2. **Simple (Labor ‚Üí Resource)**:
   - Spends Labor to produce a resource using the `Labor ‚Üí Resource` slider.
   - Example: Spending Labor to produce Stone.

## Allocation & Execution Rules

- **Percentages replace orders**: Every loop recomputes usage based on sliders, entity type, and building activity.
- **Per-resource budgets**: Complex and labor sliders consume independent portions of the 90% resource budget; zeroing a
  slider skips that recipe.
- **5% increments & clamping**: Sliders move in 5% increments and stay within the 0‚Äì90% range.
- **Auto-managed lists**: Any resource with active production is auto-added so presets work the moment new buildings are
  created. Removing the building later prunes the entry automatically.

## Presets

- `Labor:` Spreads up to 10% labor burn across eligible outputs while respecting shared inputs.
- `Resource:` Pushes complex crafting to the ceiling.
- `Custom:` Combines resource + labor preset.
- `Idle:` Drops every slider to 0%, effectively pausing production for that entity.

## Managing Automation Orders (UI)

![Managing Automation Orders](/gifs/produce-from-automation.gif)

1. **Open a realm or camp** and select the **Automation** panel in the right side navigation menu.
2. **Click modify** to open up the production setup.
3. **Adjust percentages**:
   - `Resource ‚Üí Resource`: How much of that resource‚Äôs complex inputs to burn per loop.
   - `Labor ‚Üí Resource`: How much labor-based production to run (disabled for Donkeys and military-only recipes).
4. **Apply presets** (optional): Labor, Resource, Custom, and Idle presets instantly redistribute sliders across the
   entity.
5. **Repeat for other entities**. Changes save instantly and feed into the next global loop.

#### Auto-balancing & Maintenance

- When new buildings finish, their resources auto-insert into the automation list so presets continue to work.
- Resetting an entity wipes its allocations but keeps the entity record for fast reconfiguration.
- At the start of a new Blitz season, stored configs are cleared to avoid stale setups.

### Pausing Automation

You can pause production at different levels:

1. **Individual Resource**: Set both sliders to 0% for a single resource.
2. **Entity-wide**: Apply the Idle preset to drop all sliders to 0% until you are ready to resume.

## Execution Summaries

After each loop the realm panel shows:

- **Timestamp** of the last run.
- **Produced/Consumed totals** grouped by resource so you can see net flows.
- **Skipped recipes** plus reasons (missing inputs, missing labor recipe, etc.).
- **Total cycles** executed across complex and simple recipes.

Use this view to verify slider settings or debug why a resource isn‚Äôt running (e.g., depleted labor inputs).

## Important Considerations

### General Requirements

- **Browser must stay open**: The automation store lives in your browser. Closing the Blitz tab pauses every loop.
- **Loop cadence**: Production automation evaluates roughly every 60 seconds; it won‚Äôt react faster even if you change a
  slider immediately.

### Production Automation Considerations

- **Resource availability**: Production only executes if the realm has the required inputs at processing time.
- **Recipe dependencies**: You can‚Äôt produce outputs that lack valid recipes or buildings.

### Best Practices

1. **Start conservative**: Begin with low percentages to watch how inputs drain.
2. **Monitor early loops**: Use execution summaries after the first few runs to confirm cycle counts and skips.
3. **Lean on presets**: Labor/Resource/Idle presets are the fastest way to reorient an entity without endless slider
   drags.
