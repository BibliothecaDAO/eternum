# ü§ñ Resource Automation

Resource automation covers two loops in Blitz: **production automation** (continuous realm/village crafting) and
**transfer automation** (recurring shipments between your entities). This update focuses on the production side, which
recently moved away from ‚Äúorders‚Äù in favor of preset-driven allocations.

## Production Automation at a Glance

- **Global loop**: Every 60 seconds the client evaluates all of your realms/villages and executes any valid production
  plan.
- **Per-resource percentages**: Instead of one-off jobs, each resource has sliders that describe how much of its inputs
  you are willing to burn through complex (resource‚Üíresource) or simple (labor‚Üíresource) recipes.
- **Safety rails**: Inputs are capped at 90% of their current balance, Wheat/Labor outputs are blocked entirely, and
  Donkeys are automatically limited to 10% for complex crafting.
- **Presets**: ‚ÄúLabor‚Äù, ‚ÄúResource‚Äù, ‚ÄúCustom‚Äù, and ‚ÄúIdle‚Äù presets instantly distribute percentages across every resource
  that has active buildings, respecting entity type (realm vs village) and recipe availability.
- **Local persistence**: Configurations are saved per season in your browser. Refreshing or closing the tab keeps the
  latest sliders and last execution summary.

> ‚ö†Ô∏è The automation loop runs inside your browser. Keep the Blitz tab in the foreground (or at least open) whenever you
> expect automation to fire; closing the tab stops both production and transfer processing.

## How the Loop Works

1. **Realm discovery**: On load the client pulls every realm/village you own and ensures each has an automation config.
2. **Resource scan**: Any resource with buildings or active production is auto-added (unless it‚Äôs blocked) so its inputs
   are tracked even if you never touched the sliders.
3. **Budgeting**: For each resource the system computes a ‚Äúbudget‚Äù equal to 90% of its simulated balance at the current
   tick. Percentages merely describe how much of that budget to dedicate to complex vs simple recipes.
4. **Plan generation**:
   - Complex recipes reserve inputs based on your percentage cap and the recipe‚Äôs per-cycle requirement.
   - Labor recipes do the same with their listed inputs. If not enough inputs are available the recipe is skipped and
     appears in the summary.
5. **Execution**: If at least one recipe has non-zero cycles, Blitz submits a single `execute_realm_production_plan`
   Starknet transaction for that realm/village.
6. **Feedback loop**: The store records how many cycles ran, total inputs consumed, outputs produced, and any skipped
   resources so the UI can show ‚Äúlast run‚Äù stats.

### Entity Coverage

- **Realms and Villages** are supported. Hyperstructures and other entity types are ignored by the production loop.
- Each entity gets its own automation profile. Removing ownership (selling, conquest) causes the profile to be pruned.

### Blocked or Special Resources

- **Wheat and Labor outputs** are blocked from automation to prevent runaway feedback loops.
- **Donkeys** default to 10% resource‚Üíresource and 0% labor‚Üíresource. The slider enforces these caps so you always have
  beasts of burden for transfers/military.
- **Input-only restrictions**: Even if an output is blocked, it can still be consumed as an input for other recipes.

## Configuring Production Automation

1. **Open a realm/village** and select the **Automation** panel in the production sidebar.
2. **Review auto-added resources**. Any resource that currently has buildings is already listed with baseline
   percentages. You can remove extras if you want to keep the panel tidy.
3. **Adjust percentages**:
   - `Resource ‚Üí Resource`: How much of that resource‚Äôs complex inputs you are willing to burn per loop.
   - `Labor ‚Üí Resource`: How much labor-based production to run. (Disabled for Donkeys and military-only recipes.)
   - Values are rounded to 5% increments and clamped between 0 and 90%.
4. **Apply presets** (optional):
   - `Labor`: Evenly spreads up to 10% labor burn across eligible outputs while respecting shared inputs.
   - `Resource`: Pushes complex crafting as high as possible (still honoring input caps and blocked resources).
   - `Custom`: Keeps whatever manual sliders you set.
   - `Idle`: Sets every slider to 0%, effectively pausing production for that entity.
5. **Save & repeat** for your other entities. Any slider change is saved immediately and will be used in the next loop.

### Auto-balancing & Maintenance

- When a resource starts producing (new buildings finish) the automation store ensures it has a slider entry so presets
  continue to work. Removing the building later automatically drops the extra entry.
- If you reset an entity the store wipes its allocations but keeps the entity record so you can reconfigure quickly.
- Per-season pruning means you get a clean slate when a new Blitz season launches, avoiding stale configs.

## Execution Summaries

After each successful loop the realm panel shows:

- **Timestamp** of the last run.
- **Produced/Consumed totals** grouped by resource so you can see net flows.
- **Skipped recipes** with reasons (missing inputs, missing labor recipe, etc.).
- **Total cycles** executed across complex and simple recipes.

Use this view to verify slider settings or debug why a resource is not being automated (e.g., labor inputs depleted).

---

## Transfer Automation (unchanged)

Transfer automation allows you to automatically move resources between your entities. There are three transfer modes:

### Transfer Order Processing

- **Schedule Check**: For recurring transfers, checks if enough time has passed since the last transfer.
- **Threshold Check**: For conditional transfers, checks if resource levels meet the specified conditions.
- **Resource Availability**: Verifies the source entity has sufficient resources for the transfer.
- **Transaction**: If conditions are met, initiates a transfer transaction between entities.

## Production Types

There are three types of production automation:

1. **Standard (Resource-to-Resource)**:
   - Converts one or more input resources into a different output resource.
   - Example: Using Wood and Stone to produce Tools.
2. **Simple (Labor-to-Resource)**:
   - Utilizes Labor from the realm to produce a specific resource.
   - Example: Using Labor to harvest Food.
3. **Resource-to-Labor**:
   - Converts a specified resource into Labor for the realm.
   - Example: Burning Food to generate Labor.

## Production Order Modes

Production orders can operate in two different modes:

1. **Produce Once**:
   - Produces resources until the target amount is reached, then stops.
   - Shows progress as "Produced / Target" (e.g., "1,500 / 5,000").
   - Can be set to "Infinite" to produce continuously without a limit.

2. **Maintain Balance**:
   - Keeps resource balance at the target level.
   - Production triggers when balance drops below target minus buffer percentage.
   - Example: Target 10,000 with 10% buffer = production starts when balance drops below 9,000.
   - Useful for maintaining steady resource levels.

## Transfer Types

Transfer automation allows you to automatically move resources between your entities. There are three transfer modes:

1. **Recurring Transfers**:
   - Transfers resources at regular intervals.
   - Minimum interval: 1 minute (due to automation cycle).
   - Example: Transfer 1,000 Food from Realm A to Realm B every 2 hours.

2. **Maintain Stock Transfers**:
   - Transfers when the destination entity falls below a threshold.
   - Example: Transfer 500 Wood to Realm B when it has less than 1,000 Wood.
   - Helps keep important entities well-supplied.

3. **Depletion Transfers**:
   - Transfers when the source entity exceeds a threshold.
   - Example: Transfer excess Stone when Realm has more than 5,000 Stone.
   - Prevents resource overflow and distributes surplus.

## Managing Transfer Automation (UI)

Transfer automation allows you to move resources between any of your entities.

#### Adding a New Transfer Order

1. **Select Source Entity**:
   - Choose entity type (Your Realms, Your Villages, etc.)
   - Search and select the specific source entity
2. **Configure Transfer**:
   - **Transfer Mode**:
     - `Recurring`: Transfer at regular intervals
     - `Maintain Stock`: Transfer when destination is low
     - `Depletion Transfer`: Transfer when source is high
   - **Destination Entity**:
     - Choose entity type and select specific destination
   - **Resources to Transfer**:
     - Add multiple resources with specific amounts
   - **Schedule/Conditions**:
     - For Recurring: Set interval in minutes (minimum 1 minute)
     - For conditional transfers: Set threshold amounts

3. Click "Add Transfer Automation".

#### Transfer Interval Guidelines

- **Minimum Interval**: TBC (matches automation processing cycle)
- **Custom Intervals**: Custom intervals can be set in minutes
- **Effective Timing**: Transfers occur when automation cycles align with your interval

### Viewing and Managing Orders

#### Individual Entity View

Each entity shows its automation orders in a table with:

- **Priority**: Order execution priority
- **Mode**: "Once", "Maintain", or transfer mode ("Recurring", "Stock", "Depletion")
- **Resource**: Visual representation of resource flow
- **Target/Balance**: Target amounts or transfer schedules
- **Produced**: Amount produced (production orders only)
- **Type**: Order type (production or transfer)
- **Actions**: Remove button

#### Global Automation View

The "All Automations" view shows orders from all entities:

- **Realm Filter**: Filter by specific realm or view all
- **Order Status**: Visual indicators for completed, paused, or active orders
- **Countdown Timer**: Shows time until next automation cycle
- **Bulk Actions**: Pause/resume or delete orders

### Pausing Automation

You can pause automation at different levels:

1. **Individual Entity**: Pause all automation for a specific entity
2. **Individual Order**: Remove specific orders
3. **Global Control**: Manage all orders from the global view

## Important Considerations

### General Requirements

- **Browser Must Be Open**: Automation processing occurs in your browser. If you close the game tab or your browser,
  automated processes will stop.
- **10-Minute Processing Cycle**: All automation is processed every minute. This affects timing for all orders.
- **Transaction Costs**: Each successful automation cycle that results in production or transfer will involve a
  blockchain transaction, which incurs network transaction fees.
- **Processing Time**: Due to the 10-minute processing interval and potential network conditions, there might be a delay
  before an order is executed or its results are visible.

### Production Automation Considerations

- **Resource Availability**: Production orders will only execute if the required input resources are available in the
  realm at the time of processing.
- **Recipe Dependencies**: Production follows predefined game recipes. You cannot produce resources that don't have
  valid recipes.
- **Storage Limits**: Produced resources will increase your realm's balance and may cause resource loss if storage is
  full.

### Transfer Automation Considerations

- **Entity Ownership**: You can only set up transfers between entities you own.
- **Transfer Timing**:
  - Minimum effective interval is 1 minute due to processing cycle
  - Intervals shorter than 1 minute will effectively transfer every minute
  - Non-10-minute multiples may have irregular timing based on when transfers align with processing cycles
- **Resource Availability**: Transfers will only execute if the source entity has sufficient resources at processing
  time.
- **Multiple Resources**: You can transfer multiple different resources in a single transfer order.
- **Conditional Logic**: Maintain Stock and Depletion transfers check conditions each cycle and only transfer when
  thresholds are met.

### Best Practices

1. **Start Simple**: Begin with basic production orders or simple recurring transfers to understand the system.
2. **Monitor Initially**: Watch your first few automation cycles to ensure orders work as expected.
3. **Use Priorities**: Set appropriate priorities when you have multiple orders to control execution sequence.
4. **Plan for Delays**: Account for the 10-minute processing cycle when planning time-sensitive operations.
5. **Check Resource Flows**: Regularly verify that your automated transfers are maintaining desired resource
   distributions.
